- name: Pipenv Tox-based Tests
  hosts: all
  tasks:
    - name: Make sure pipenv and tox are installed
      shell: pip install --user pipenv tox
    - name: Upgrade pip
      shell: pip install --user ansible pathlib scandir
      when: install_ansible | default(True) | bool
    - name: Run tox
      args:
        chdir: "{{ zuul.project.src_dir }}"
      environment:
        PATH: "{{ ansible_env.PATH }}:{{ ansible_env.HOME }}/.local/bin"
      command: "tox"
