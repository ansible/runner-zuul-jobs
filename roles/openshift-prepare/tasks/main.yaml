- name: Install origin repository
  yum:
    name: "{{ item }}"
  with_items:
    - "{{ origin_repo }}"
    - centos-release-scl-rh

- name: Install requirements
  yum:
    name: "{{ item }}"
  with_items:
    - origin
    - docker
    - python-docker-py
    # We need git29 for --first-parent parameter
    - rh-git29

- name: Fix docker start options
  lineinfile:
    dest: /etc/sysconfig/docker
    regexp: "^OPTIONS="
    line: "OPTIONS='--selinux-enabled --log-driver=journald --signature-verification=false --insecure-registry 172.30.0.0/16'"

# See: https://github.com/openshift/origin/issues/15038
- name: Fix rhel secret issue
  file:
    path: /usr/share/rhel/secrets
    state: absent

- name: Start docker service
  service:
    name: docker
    state: started

- name: Pull origin images
  command: "docker pull docker.io/openshift/{{ item }}:{{ origin_version }}"
  with_items:
    - origin-web-console
    - origin-docker-registry
    - origin-haproxy-router
    - origin-deployer
    - origin-sti-builder
    - origin-pod
    - origin
